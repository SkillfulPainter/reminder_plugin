# â° æ™ºèƒ½æé†’æ’ä»¶ (Smart Reminder Plugin)

> ä¸º [MaiBot](https://github.com/MaiM-with-u/MaiBot) è®¾è®¡çš„å¼ºå¤§å®šæ—¶æé†’ç³»ç»Ÿï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€è§£æã€æ•°æ®åº“æŒä¹…åŒ–å­˜å‚¨ä¸æ‹ŸäººåŒ–æé†’æ¨é€ã€‚

![Version](https://img.shields.io/badge/version-1.1.0-blue)
![License](https://img.shields.io/badge/license-GPL--3.0-green)
![Author](https://img.shields.io/badge/author-SkillfulPainter-orange)

## ğŸ“– ç®€ä»‹

**Smart Reminder Plugin** æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ MaiBot æ¡†æ¶ä¸‹çš„å®ç”¨å·¥å…·æ’ä»¶ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡è‡ªç„¶çš„å¯¹è¯æ–¹å¼è®¾ç½®å®šæ—¶æé†’ã€‚

ä¸åŒäºç®€å•çš„å€’è®¡æ—¶å·¥å…·ï¼Œæœ¬æ’ä»¶æ·±åº¦é›†æˆäº† LLM çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ™ºèƒ½è§£ææ¨¡ç³Šçš„æ—¶é—´è¡¨è¾¾ï¼ˆå¦‚â€œæ˜å¤©è¿™ä¸ªæ—¶å€™â€ï¼‰ï¼Œå¹¶åœ¨è§¦å‘æé†’æ—¶ç»“åˆ Bot çš„äººè®¾ï¼ˆPersonaï¼‰ç”Ÿæˆç¬¦åˆæ€§æ ¼çš„æé†’è¯æœ¯ï¼Œè€Œä¸æ˜¯æ­»æ¿çš„æœºå™¨é€šçŸ¥ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

* **ğŸ—£ï¸ è‡ªç„¶è¯­è¨€äº¤äº’**ï¼šæ— éœ€æ­»è®°ç¡¬èƒŒæŒ‡ä»¤æ ¼å¼ï¼Œæ”¯æŒ "ååˆ†é’Ÿåæé†’æˆ‘"ã€"æ˜å¤©æ—©ä¸Šä¹ç‚¹å«æˆ‘å¼€ä¼š" ç­‰è‡ªç„¶è¡¨è¾¾ã€‚
* **ğŸ¤– LLM æ™ºèƒ½æ—¶é—´è§£æ**ï¼šå†…ç½®æ—¶é—´è§£æå™¨ï¼Œé’ˆå¯¹å¤æ‚çš„æ—¶é—´æè¿°ï¼ˆå¦‚ "ä¸‹å‘¨ä¸‰ä¸‹åˆ"ï¼‰è°ƒç”¨ LLM (`utils_small` æ¨¡å‹) è¿›è¡Œç²¾å‡†è½¬æ¢ã€‚
* **ğŸ’¾ æ•°æ®æŒä¹…åŒ–**ï¼šæ‰€æœ‰æé†’äº‹é¡¹å†™å…¥æ•°æ®åº“ã€‚å³ä½¿ Bot ç¨‹åºé‡å¯æˆ–å´©æºƒï¼Œæœªè¿‡æœŸçš„æé†’ä»»åŠ¡åœ¨é‡å¯åä¾ç„¶ä¼šè¢«è°ƒåº¦æ‰§è¡Œï¼Œä¸ä¼šä¸¢å¤±ã€‚
* **ğŸ­ æ‹ŸäººåŒ–æé†’**ï¼šæé†’è§¦å‘æ—¶ï¼Œä¼šæ ¹æ® Bot å½“å‰çš„äººè®¾ï¼ˆNickname / Personalityï¼‰åˆ©ç”¨ LLM å®æ—¶é‡å†™æé†’å†…å®¹ï¼Œè®©é€šçŸ¥æ›´å…·æ¸©åº¦ã€‚
* **âš¡ é«˜æ•ˆåå°è°ƒåº¦**ï¼šé‡‡ç”¨åŸºäºæ—¶é—´çª—å£ï¼ˆSliding Windowï¼‰çš„åå°è°ƒåº¦å™¨ï¼Œå®šæœŸæ‰«ææ•°æ®åº“ï¼Œé«˜æ•ˆç®¡ç†è¿‘æœŸä»»åŠ¡ï¼Œé™ä½å†…å­˜å ç”¨ã€‚

## ğŸš€ å¦‚ä½•ä½¿ç”¨

ç¡®ä¿æ’ä»¶å·²å¯ç”¨ï¼Œåœ¨ç§èŠæˆ–ç¾¤èŠä¸­å¯¹ Bot å‘é€åŒ…å«å…³é”®è¯çš„æ¶ˆæ¯ã€‚

**è§¦å‘å…³é”®è¯ï¼š** `æé†’`ã€`å«æˆ‘`ã€`è®°å¾—`ã€`åˆ«å¿˜äº†`

### ç¤ºä¾‹

* **ç›¸å¯¹æ—¶é—´ï¼š**
    > "10åˆ†é’Ÿå**æé†’**æˆ‘å…³ç«"
* **ç»å¯¹æ—¶é—´ï¼š**
    > "æ˜å¤©æ—©ä¸Š8ç‚¹**å«æˆ‘**èµ·åºŠ"
* **æ¨¡ç³Šæ—¶é—´ï¼ˆä¾èµ–å½“å‰è¯­å¢ƒï¼‰ï¼š**
    > "**åˆ«å¿˜äº†**æ™šä¸Š10ç‚¹æé†’æˆ‘æŠ¢ç¥¨"

*æ³¨æ„ï¼šå¦‚æœæœªæŒ‡å®šå…·ä½“æ—¶é—´ï¼ŒBot ä¼šæç¤ºä½ è¡¥å……æ—¶é—´ä¿¡æ¯ã€‚*

## âš™ï¸ é…ç½®å‚æ•°

æ’ä»¶é…ç½®æ–‡ä»¶ä½äº `config.toml`ï¼Œæ”¯æŒçƒ­é‡è½½ï¼ˆè§†ä¸»ç¨‹åºå®ç°è€Œå®šï¼‰ã€‚

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- |
| **[components]** | | |
| `action_set_reminder_enable` | `true` | æ˜¯å¦å¼€å¯æé†’åŠŸèƒ½çš„ä¸»å¼€å…³ã€‚ |
| **[reminder_settings]** | | |
| `scheduler_scan_interval` | `3600` | **æ•°æ®åº“æ‰«æé—´éš”ï¼ˆç§’ï¼‰**ã€‚<br>åå°è°ƒåº¦å™¨æ¯éš”å¤šä¹…æ‰«æä¸€æ¬¡æ•°æ®åº“ï¼ŒæŸ¥æ‰¾æ–°ä»»åŠ¡ã€‚é»˜è®¤ä¸º1å°æ—¶ã€‚ |
| `scheduler_lookahead_window` | `86400` | **é¢„åŠ è½½æ—¶é—´çª—å£ï¼ˆç§’ï¼‰**ã€‚<br>æ¯æ¬¡æ‰«ææ—¶ï¼Œå°†æœªæ¥å¤šä¹…å†…çš„ä»»åŠ¡åŠ è½½åˆ°å†…å­˜é˜Ÿåˆ—ä¸­ã€‚é»˜è®¤ä¸º24å°æ—¶ã€‚ |
| `send_confirmation` | `true` | **å‘é€ç¡®è®¤æ¶ˆæ¯**ã€‚<br>è®¾ç½®æé†’æˆåŠŸåï¼Œæ˜¯å¦ç«‹å³å‘é€ä¸€æ¡"å¥½çš„ï¼Œå·²è®¾ç½®..."çš„ç¡®è®¤å›å¤ã€‚ |

## ğŸ› ï¸ å®ç°åŸç†

æœ¬æ’ä»¶åŸºäº Python å¼‚æ­¥ç¼–ç¨‹ (`asyncio`) å®ç°ï¼Œä¸»è¦ç”±ä»¥ä¸‹æ¨¡å—æ„æˆï¼š

1.  **RemindAction (åŠ¨ä½œè§¦å‘)**ï¼š
    * é€šè¿‡å…³é”®è¯æ•è·ç”¨æˆ·æ„å›¾ã€‚
    * ä½¿ç”¨ `dateutil` è¿›è¡ŒåŸºç¡€æ—¶é—´è§£æï¼Œè‹¥å¤±è´¥åˆ™ Fallback åˆ° **LLM (Planner Model)** è¿›è¡Œè‡ªç„¶è¯­è¨€æ—¶é—´ç†è§£ã€‚
    * å°†è§£æåçš„æ ‡å‡†æ—¶é—´æˆ³ä¸äº‹ä»¶å†…å®¹å­˜å…¥ `ActionRecords` æ•°æ®åº“è¡¨ã€‚

2.  **ReminderScheduler (å…¨å±€è°ƒåº¦å™¨)**ï¼š
    * è¿™æ˜¯ä¸€ä¸ªåå°é©»ç•™çš„ `AsyncTask`ã€‚
    * é‡‡ç”¨ **"ç”Ÿäº§è€…-æ¶ˆè´¹è€…"** æ¨¡å¼çš„å˜ä½“ï¼šæ¯éš” `scan_interval` ç§’æ‰«ææ•°æ®åº“ï¼ŒæŸ¥æ‰¾ `[å½“å‰æ—¶é—´, å½“å‰æ—¶é—´ + window_seconds]` èŒƒå›´å†…çš„æœªå®Œæˆä»»åŠ¡ã€‚
    * å°†ç¬¦åˆæ¡ä»¶çš„ä»»åŠ¡å®ä¾‹åŒ–ä¸º `DatabaseReminderTask` å¹¶æ³¨å…¥å†…å­˜ä»»åŠ¡é˜Ÿåˆ—ã€‚
    * è‡ªåŠ¨å¤„ç†è¿‡æœŸæœªæ‰§è¡Œçš„ä»»åŠ¡ï¼ˆæ ‡è®°ä¸ºå®Œæˆä»¥é˜²æ­»å¾ªç¯ï¼‰ã€‚

3.  **DatabaseReminderTask (ä»»åŠ¡æ‰§è¡Œå•å…ƒ)**ï¼š
    * è´Ÿè´£å…·ä½“çš„å€’è®¡æ—¶ç­‰å¾… (`asyncio.sleep`)ã€‚
    * **Double Check æœºåˆ¶**ï¼šå€’è®¡æ—¶ç»“æŸåï¼Œå†æ¬¡æŸ¥è¯¢æ•°æ®åº“ç¡®è®¤ä»»åŠ¡æœªè¢«å–æ¶ˆã€‚
    * **äººè®¾æ³¨å…¥**ï¼šè°ƒç”¨ `generator_api.rewrite_reply`ï¼Œæç¤º LLM "ç°åœ¨æ˜¯æé†’æ—¶é—´ï¼Œè¯·ä»¥ç¬¦åˆä½ äººè®¾çš„æ–¹å¼æé†’ç”¨æˆ·"ï¼Œç”Ÿæˆæœ€ç»ˆçš„æ¨é€æ¶ˆæ¯ã€‚

## ğŸ“¦ å®‰è£…è¯´æ˜

1.  å°†æœ¬æ’ä»¶æ–‡ä»¶å¤¹æ”¾å…¥ MaiBot çš„ `plugins` ç›®å½•ä¸‹ã€‚
2.  ç¡®ä¿ MaiBot æ ¸å¿ƒç‰ˆæœ¬ >= 0.8.0ã€‚
3.  é‡å¯ MaiBotï¼Œæ’ä»¶å°†è‡ªåŠ¨åŠ è½½å¹¶ç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶ã€‚

## ğŸ‘¨â€ğŸ’» ä½œè€…

**SkillfulPainter**
* GitHub: [https://github.com/SkillfulPainter](https://github.com/SkillfulPainter)
* Repository: [https://github.com/SkillfulPainter/reminder_plugin](https://github.com/SkillfulPainter/reminder_plugin)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [GPL-v3.0](LICENSE) åè®®å¼€æºã€‚

---
*é€‚é…é¡¹ç›®ï¼š[MaiBot - ä¸€ä¸ªå¼ºå¤§çš„å¤šæ¨¡æ€ AI èŠå¤©æœºå™¨äººæ¡†æ¶](https://github.com/MaiM-with-u/MaiBot)*